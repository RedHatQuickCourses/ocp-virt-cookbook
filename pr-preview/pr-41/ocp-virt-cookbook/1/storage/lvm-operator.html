<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Installing LVM Storage Operator :: OpenShift Virtualization cookbook</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="lvm-troubleshooting.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">OpenShift Virtualization cookbook</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/ocp-virt-cookbook/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ocp-virt-cookbook" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OpenShift Virtualization cookbook</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting-started/index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/prerequisites.html">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/virtctl-basics.html">Virtctl Basics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/default-storage-class.html">Storage Setup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Storage Configuration</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="lvm-operator.html">LVM Operator Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lvm-troubleshooting.html">LVM Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../networking/index.html">Networking Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/udn-primary-networks.html">UDN Primary Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/localnet-secondary.html">Localnet Secondary Networks with CUDN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/localnet-vlan.html">Localnet Secondary Networks with VLAN using NAD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/cudn-localnet-vlan.html">Localnet VLAN with CUDN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/linux-bridges.html">Linux Bridges</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/ovs-bridge-troubleshooting.html">Troubleshooting Localnet Networks</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../vm-configuration/index.html">Virtual Machine Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/cloud-init-ip-configuration.html">Cloud-init IP Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/cloud-init-troubleshooting.html">Cloud-init Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/internal-dns-for-vms.html">Internal DNS for VMs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/remote-access-linux-vms.html">Remote Access to Linux VMs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/remote-access-linux-troubleshooting.html">Remote Access to Linux VMs Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/remote-access-windows-vms.html">Remote Access to Windows VMs via RDP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/custom-golden-images.html">Custom Golden Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/golden-images-troubleshooting.html">Golden Images Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../manifests/index.html">YAML Manifests Reference</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/operators.html">Operators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/networking.html">Networking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/storage.html">Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/vms.html">Virtual Machines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/security.html">Security</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../api/index.html">API Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/api_component_overview.html">API Component Overview</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../lab-env/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenShift Virtualization cookbook</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">OpenShift Virtualization cookbook</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">OpenShift Virtualization cookbook</a></li>
    <li><a href="index.html">Storage Configuration</a></li>
    <li><a href="lvm-operator.html">LVM Operator Installation</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Installing LVM Storage Operator</h1>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial demonstrates how to install and configure the LVM Storage operator to use a spare local disk on OpenShift nodes. The LVM operator provides dynamic storage provisioning using Logical Volume Manager, ideal for Single Node OpenShift (SNO) or bare-metal clusters with local storage.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>OpenShift 4.18+</strong></p>
</li>
<li>
<p><strong>Local disk available</strong>: At least one spare disk on cluster nodes</p>
</li>
<li>
<p><strong>Cluster admin access</strong>: Required to install operators and create storage classes</p>
</li>
<li>
<p><strong>Disk can have existing data</strong>: The operator can force-wipe disks using the <code>forceWipeDevicesAndDestroyAllData</code> parameter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Versions tested:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OpenShift 4.19, 4.20</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_important_warning"><a class="anchor" href="#_important_warning"></a>Important Warning</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using the <code>forceWipeDevicesAndDestroyAllData: true</code> parameter will permanently destroy all data on the specified disk. Ensure you have backups and are using the correct disk device path before proceeding.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_1_identify_available_disks"><a class="anchor" href="#_step_1_identify_available_disks"></a>Step 1: Identify Available Disks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before configuring the LVM operator, identify which disk you want to use for storage.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Get your node name
oc get nodes

# List all block devices on the node
oc debug node/&lt;node-name&gt; -- chroot /host lsblk -o NAME,SIZE,TYPE,FSTYPE,MOUNTPOINT,MODEL</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME    SIZE TYPE FSTYPE      MOUNTPOINT MODEL
sda   558.4G disk LVM2_member            PERC H730 Adp
sdc   558.4G disk                        PERC H730 Adp
|-sdc1   1M part
|-sdc2 127M part vfat
|-sdc3 384M part ext4        /boot
`-sdc4 557.9G part xfs        /sysroot</pre>
</div>
</div>
<div class="paragraph">
<p>In this example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sda</code> - Spare disk with existing LVM data (this will be our target)</p>
</li>
<li>
<p><code>sdc</code> - System disk with OS partitions (DO NOT USE)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Check for existing LVM usage:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc debug node/&lt;node-name&gt; -- chroot /host pvs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>PV         VG  Fmt  Attr PSize   PFree
/dev/sda   vg1 lvm2 a--  558.37g &lt;55.84g</pre>
</div>
</div>
<div class="paragraph">
<p>This shows <code>/dev/sda</code> has existing LVM configuration that will be wiped when using <code>forceWipeDevicesAndDestroyAllData: true</code>.</p>
</div>
<div class="paragraph">
<p>Get disk device path for persistent identification:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc debug node/&lt;node-name&gt; -- chroot /host ls -la /dev/disk/by-path/ | grep -E "pci.*scsi"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>lrwxrwxrwx. 1 root root 9 Oct 6 13:30 pci-0000:03:00.0-scsi-0:2:1:0 -&gt; ../../sda</pre>
</div>
</div>
<div class="paragraph">
<p>The persistent path <code>/dev/disk/by-path/pci-0000:03:00.0-scsi-0:2:1:0</code> points to <code>/dev/sda</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_2_install_lvm_storage_operator"><a class="anchor" href="#_step_2_install_lvm_storage_operator"></a>Step 2: Install LVM Storage Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create the namespace and install the LVM Storage operator.</p>
</div>
<div class="paragraph">
<p>Create namespace for LVM operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">oc apply -f - &lt;&lt;EOF
apiVersion: v1
kind: Namespace
metadata:
  name: openshift-lvm-storage
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create OperatorGroup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">oc apply -f - &lt;&lt;EOF
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: openshift-lvm-storage-operatorgroup
  namespace: openshift-lvm-storage
spec:
  targetNamespaces:
  - openshift-lvm-storage
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create Subscription to install the operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">oc apply -f - &lt;&lt;EOF
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: lvms-operator
  namespace: openshift-lvm-storage
spec:
  channel: stable-4.20
  name: lvms-operator
  source: redhat-operators
  sourceNamespace: openshift-marketplace
  installPlanApproval: Automatic
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify operator installation:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Wait for the operator to be installed (may take 2-3 minutes)
oc get csv -n openshift-lvm-storage

# Check operator pod is running
oc get pods -n openshift-lvm-storage</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output (after operator installation, before LVMCluster):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                             READY   STATUS    RESTARTS   AGE
lvms-operator-864b6975bb-kxt4t   1/1     Running   0          2m</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At this stage, you should only see the <code>lvms-operator</code> pod. The <code>vg-manager</code> pod will be created automatically after you create the LVMCluster resource in Step 3.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Expected output (after LVMCluster is created in Step 3):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                                  READY   STATUS    RESTARTS   AGE
lvms-operator-864b6975bb-kxt4t        1/1     Running   0          5m
vg-manager-xxxxx                      1/1     Running   0          1m</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_3_create_lvmcluster_configuration"><a class="anchor" href="#_step_3_create_lvmcluster_configuration"></a>Step 3: Create LVMCluster Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create an LVMCluster resource to configure the LVM storage backend. This is where you specify which disk to use and whether to force-wipe existing data.</p>
</div>
<div class="sect2">
<h3 id="_configuration_for_disk_with_existing_data"><a class="anchor" href="#_configuration_for_disk_with_existing_data"></a>Configuration for Disk with Existing Data</h3>
<div class="paragraph">
<p>If your disk has existing data or partitions (like our <code>sda</code> example), use <code>forceWipeDevicesAndDestroyAllData: true</code>:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using <code>forceWipeDevicesAndDestroyAllData: true</code> will permanently destroy all data on the specified disk. Ensure you have backups and are using the correct disk device path before proceeding.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">oc apply -f - &lt;&lt;EOF
apiVersion: lvm.topolvm.io/v1alpha1
kind: LVMCluster
metadata:
  name: lvmcluster
  namespace: openshift-lvm-storage
spec:
  storage:
    deviceClasses:
    - name: vg1
      default: true
      thinPoolConfig:
        name: thin-pool-1
        sizePercent: 90
        overprovisionRatio: 10
      nodeSelector:
        nodeSelectorTerms:
        - matchExpressions:
          - key: node-role.kubernetes.io/worker
            operator: In
            values:
            - ""
      deviceSelector:
        paths:
        - /dev/sda
        forceWipeDevicesAndDestroyAllData: true
EOF</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_for_cleannew_disk"><a class="anchor" href="#_configuration_for_cleannew_disk"></a>Configuration for Clean/New Disk</h3>
<div class="paragraph">
<p>If your disk is clean with no existing data or partitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">oc apply -f - &lt;&lt;EOF
apiVersion: lvm.topolvm.io/v1alpha1
kind: LVMCluster
metadata:
  name: lvmcluster
  namespace: openshift-lvm-storage
spec:
  storage:
    deviceClasses:
    - name: vg1
      default: true
      thinPoolConfig:
        name: thin-pool-1
        sizePercent: 90
        overprovisionRatio: 10
      nodeSelector:
        nodeSelectorTerms:
        - matchExpressions:
          - key: node-role.kubernetes.io/worker
            operator: In
            values:
            - ""
      deviceSelector:
        paths:
        - /dev/sda
EOF</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_parameters_explained"><a class="anchor" href="#_configuration_parameters_explained"></a>Configuration Parameters Explained</h3>
<div class="ulist">
<ul>
<li>
<p><strong><code>name: vg1</code></strong>: Volume group name (will be created on the disk)</p>
</li>
<li>
<p><strong><code>default: true</code></strong>: Makes this deviceClass the default for the cluster</p>
<div class="ulist">
<ul>
<li>
<p><strong>Purpose</strong>: Prevents warning about no default deviceClass</p>
</li>
<li>
<p><strong>Effect</strong>: The generated StorageClass will be available without explicitly specifying it in PVCs</p>
</li>
<li>
<p><strong>Note</strong>: If you have multiple deviceClasses, only one should be marked as default</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><code>thinPoolConfig</code></strong>: Configures thin provisioning for efficient storage use</p>
<div class="ulist">
<ul>
<li>
<p><code>sizePercent: 90</code>: Use 90% of disk space for the thin pool</p>
</li>
<li>
<p><code>overprovisionRatio: 10</code>: Allow 10x overprovisioning (provision more storage than physically available)</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><code>nodeSelector</code></strong>: Which nodes to configure (worker nodes in this example)</p>
</li>
<li>
<p><strong><code>deviceSelector.paths</code></strong>: Specific disk device paths to use</p>
<div class="ulist">
<ul>
<li>
<p>Can use <code>/dev/sda</code>, <code>/dev/disk/by-path/&#8230;&#8203;</code>, or <code>/dev/disk/by-id/&#8230;&#8203;</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><code>forceWipeDevicesAndDestroyAllData: true</code></strong>: CRITICAL PARAMETER</p>
<div class="ulist">
<ul>
<li>
<p><strong>Purpose</strong>: Wipes all existing data and partitions on the disk</p>
</li>
<li>
<p><strong>Use when</strong>: Disk has existing filesystems, partitions, or LVM configuration</p>
</li>
<li>
<p><strong>Effect</strong>: Complete data destruction - no recovery possible</p>
</li>
<li>
<p><strong>Omit when</strong>: Disk is already clean/empty</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_4_verify_lvmcluster_status"><a class="anchor" href="#_step_4_verify_lvmcluster_status"></a>Step 4: Verify LVMCluster Status</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run a quick health check to verify the LVMCluster is ready:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Check LVMCluster status
oc get lvmcluster -n openshift-lvm-storage

# Verify volume group was created
oc debug node/&lt;node-name&gt; -- chroot /host vgs

# Verify thin pool was created
oc debug node/&lt;node-name&gt; -- chroot /host lvs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected healthy output:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>LVMCluster shows <code>STATUS: Ready</code></p>
</li>
<li>
<p>VG <code>vg1</code> appears with appropriate size</p>
</li>
<li>
<p>Thin pool <code>thin-pool-1</code> is active with low data/meta usage</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For detailed verification steps, expected outputs, and troubleshooting, see the <a href="lvm-troubleshooting.html" class="xref page">LVM Storage Troubleshooting Guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_5_set_default_storageclass"><a class="anchor" href="#_step_5_set_default_storageclass"></a>Step 5: Set Default StorageClass</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The LVM operator automatically creates a StorageClass named <code>lvms-vg1</code>, but it does not set it as the default. Making it the default StorageClass is essential for OpenShift Virtualization to automatically provision storage for VM disks and DataVolumes.</p>
</div>
<div class="sect2">
<h3 id="_verify_storageclass_exists"><a class="anchor" href="#_verify_storageclass_exists"></a>Verify StorageClass Exists</h3>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get storageclass</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME       PROVISIONER   RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE
lvms-vg1   topolvm.io    Delete          WaitForFirstConsumer   true                   5m</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
No <code>(default)</code> annotation is shown - this StorageClass is not yet the default.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_set_as_default_storageclass"><a class="anchor" href="#_set_as_default_storageclass"></a>Set as Default StorageClass</h3>
<div class="paragraph">
<p>Make the LVM StorageClass the default for the cluster:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc patch storageclass lvms-vg1 -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_verify_default_status"><a class="anchor" href="#_verify_default_status"></a>Verify Default Status</h3>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe sc | grep IsDefaultClass</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output after setting default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                 PROVISIONER   RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE
lvms-vg1 (default)   topolvm.io    Delete          WaitForFirstConsumer   true                   6m</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>(default)</code> annotation confirms this is now the default StorageClass.</p>
</div>
</div>
<div class="sect2">
<h3 id="_why_this_is_important_for_openshift_virtualization"><a class="anchor" href="#_why_this_is_important_for_openshift_virtualization"></a>Why This is Important for OpenShift Virtualization</h3>
<div class="paragraph">
<p>Setting a default StorageClass is critical for OpenShift Virtualization:</p>
</div>
<div class="sect3">
<h4 id="_datasource_os_images_require_default_storage"><a class="anchor" href="#_datasource_os_images_require_default_storage"></a>DataSource OS Images Require Default Storage</h4>
<div class="paragraph">
<p>OpenShift Virtualization&#8217;s DataSource OS images (Fedora, RHEL, CentOS Stream, Windows) need a default StorageClass to automatically create boot source volumes:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Check available OS images
oc get datasources -n openshift-virtualization-os-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Without a default StorageClass, these DataSources will remain in a pending state and cannot be used for VM creation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_automatic_pvc_creation_for_vms"><a class="anchor" href="#_automatic_pvc_creation_for_vms"></a>Automatic PVC Creation for VMs</h4>
<div class="paragraph">
<p>When creating VMs using <code>dataVolumeTemplates</code>, if no <code>storageClassName</code> is specified, the default StorageClass is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">dataVolumeTemplates:
- metadata:
    name: fedora-volume
  spec:
    pvc:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 30Gi
    sourceRef:
      kind: DataSource
      name: fedora
      namespace: openshift-virtualization-os-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>This automatically uses the default StorageClass (<code>lvms-vg1</code>) without explicitly specifying it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_simplified_vm_creation"><a class="anchor" href="#_simplified_vm_creation"></a>Simplified VM Creation</h4>
<div class="paragraph">
<p>With a default StorageClass:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VM templates work out-of-the-box</p>
</li>
<li>
<p>DataSource cloning happens automatically</p>
</li>
<li>
<p>No need to specify <code>storageClassName</code> in every PVC</p>
</li>
<li>
<p>Consistent storage provisioning across the cluster</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_boot_source_preparation"><a class="anchor" href="#_boot_source_preparation"></a>Boot Source Preparation</h4>
<div class="paragraph">
<p>The OpenShift Virtualization operator can automatically prepare boot sources for common OS images when a default StorageClass is available:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Check boot source preparation status
oc get DataImportCron -n openshift-virtualization-os-images</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_alternative_explicit_storageclass_in_vms"><a class="anchor" href="#_alternative_explicit_storageclass_in_vms"></a>Alternative: Explicit StorageClass in VMs</h3>
<div class="paragraph">
<p>If you choose not to set a default StorageClass, you must explicitly specify it in every VM definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">dataVolumeTemplates:
- metadata:
    name: fedora-volume
  spec:
    pvc:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 30Gi
      storageClassName: lvms-vg1  # Must be explicit
    sourceRef:
      kind: DataSource
      name: fedora
      namespace: openshift-virtualization-os-images</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Always set a default StorageClass for OpenShift Virtualization clusters to simplify operations and enable automatic boot source provisioning.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_6_test_storage_provisioning"><a class="anchor" href="#_step_6_test_storage_provisioning"></a>Step 6: Test Storage Provisioning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a test PVC to verify storage provisioning works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">oc apply -f - &lt;&lt;EOF
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: lvms-test-pvc
  namespace: default
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
  storageClassName: lvms-vg1
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a test pod to use the PVC:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">oc apply -f - &lt;&lt;EOF
apiVersion: v1
kind: Pod
metadata:
  name: lvms-test-pod
  namespace: default
spec:
  containers:
  - name: test
    image: registry.access.redhat.com/ubi9/ubi:latest
    command: ["sleep", "3600"]
    volumeMounts:
    - name: data
      mountPath: /data
  volumes:
  - name: data
    persistentVolumeClaim:
      claimName: lvms-test-pvc
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify PVC is bound:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pvc lvms-test-pvc

# Should show STATUS as "Bound"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify pod is running and can write to storage:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Wait for pod to start
oc wait --for=condition=Ready pod/lvms-test-pod --timeout=120s

# Test writing to the volume
oc exec lvms-test-pod -- sh -c "echo 'LVM Storage Test' &gt; /data/test.txt &amp;&amp; cat /data/test.txt"

# Expected output: LVM Storage Test</code></pre>
</div>
</div>
<div class="paragraph">
<p>Clean up test resources:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete pod lvms-test-pod
oc delete pvc lvms-test-pvc</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a>Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you encounter any issues during installation or operation of LVM storage, refer to the <a href="lvm-troubleshooting.html" class="xref page">LVM Storage Troubleshooting Guide</a>.</p>
</div>
<div class="paragraph">
<p>The troubleshooting guide covers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Complete verification commands with expected outputs</p>
</li>
<li>
<p>Common issues and their solutions</p>
</li>
<li>
<p>Device discovery and wipe problems</p>
</li>
<li>
<p>PVC provisioning issues</p>
</li>
<li>
<p>Thin pool management</p>
</li>
<li>
<p>Diagnostic procedures</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_understanding_forcewipedevicesanddestroyalldata"><a class="anchor" href="#_understanding_forcewipedevicesanddestroyalldata"></a>Understanding forceWipeDevicesAndDestroyAllData</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_it_does"><a class="anchor" href="#_what_it_does"></a>What It Does</h3>
<div class="paragraph">
<p>The <code>forceWipeDevicesAndDestroyAllData: true</code> parameter:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Removes partition tables</strong>: Wipes GPT, MBR, and any partition information</p>
</li>
<li>
<p><strong>Destroys filesystems</strong>: Removes ext4, xfs, btrfs, and other filesystem signatures</p>
</li>
<li>
<p><strong>Clears LVM metadata</strong>: Removes existing physical volumes, volume groups, and logical volumes</p>
</li>
<li>
<p><strong>Zeroes beginning of disk</strong>: Writes zeros to the first few megabytes to ensure clean state</p>
</li>
<li>
<p><strong>Forces reuse</strong>: Allows the LVM operator to take ownership of the disk</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_when_to_use_it"><a class="anchor" href="#_when_to_use_it"></a>When to Use It</h3>
<div class="paragraph">
<p>Use <code>forceWipeDevicesAndDestroyAllData: true</code> when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Disk has existing partitions or filesystems</p>
</li>
<li>
<p>Disk was previously used for LVM (has PV/VG/LV)</p>
</li>
<li>
<p>Disk has data you want to destroy</p>
</li>
<li>
<p>You&#8217;re repurposing a disk from another use case</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Don&#8217;t use it when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Disk is brand new and unformatted</p>
</li>
<li>
<p>You&#8217;re unsure which disk to use (verify first!)</p>
</li>
<li>
<p>Disk contains data you need to keep</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_safety_checks_before_using"><a class="anchor" href="#_safety_checks_before_using"></a>Safety Checks Before Using</h3>
<div class="paragraph">
<p>Always verify the disk device path before enabling this parameter:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 1. Verify the disk path
oc debug node/&lt;node-name&gt; -- chroot /host lsblk -o NAME,SIZE,TYPE,MOUNTPOINT

# 2. Ensure disk is NOT mounted
oc debug node/&lt;node-name&gt; -- chroot /host mount | grep /dev/sda

# 3. Double-check you're not using the system disk
oc debug node/&lt;node-name&gt; -- chroot /host df -h | grep sda

# 4. Review disk serial number
oc debug node/&lt;node-name&gt; -- chroot /host lsblk -d -o NAME,SERIAL /dev/sda</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_openshift_documentation"><a class="anchor" href="#_openshift_documentation"></a>OpenShift Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html/storage/persistent-storage-using-local-storage#persistent-storage-using-lvms" target="_blank" rel="noopener">Persistent Storage Using LVM Storage</a></p>
</li>
<li>
<p><a href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html/storage/understanding-persistent-storage#storage-classes_understanding-persistent-storage" target="_blank" rel="noopener">Understanding Persistent Storage</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Storage Configuration</a></span>
  <span class="next"><a href="lvm-troubleshooting.html">LVM Troubleshooting</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
