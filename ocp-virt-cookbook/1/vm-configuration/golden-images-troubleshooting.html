<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Golden Images Troubleshooting Guide :: OpenShift Virtualization cookbook</title>
    <link rel="prev" href="custom-golden-images.html">
    <link rel="next" href="../manifests/index.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">OpenShift Virtualization cookbook</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/ocp-virt-cookbook/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ocp-virt-cookbook" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OpenShift Virtualization cookbook</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting-started/index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/prerequisites.html">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/virtctl-basics.html">Virtctl Basics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/default-storage-class.html">Storage Setup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../storage/index.html">Storage Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/lvm-operator.html">LVM Operator Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/lvm-troubleshooting.html">LVM Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../networking/index.html">Networking Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/udn-primary-networks.html">UDN Primary Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/localnet-secondary.html">Localnet Secondary Networks with CUDN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/localnet-vlan.html">Localnet Secondary Networks with VLAN using NAD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/cudn-localnet-vlan.html">Localnet VLAN with CUDN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/linux-bridges.html">Linux Bridges</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/ovs-bridge-troubleshooting.html">Troubleshooting OVS Bridge Creation for Localnet Networks</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Virtual Machine Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cloud-init-ip-configuration.html">Cloud-init IP Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cloud-init-troubleshooting.html">Cloud-init Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="internal-dns-for-vms.html">Internal DNS for VMs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="remote-access-linux-vms.html">Remote Access to Linux VMs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="remote-access-linux-troubleshooting.html">Remote Access to Linux VMs Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="remote-access-windows-vms.html">Remote Access to Windows VMs via RDP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="custom-golden-images.html">Custom Golden Images</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="golden-images-troubleshooting.html">Golden Images Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../manifests/index.html">YAML Manifests Reference</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/operators.html">Operators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/networking.html">Networking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/storage.html">Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/vms.html">Virtual Machines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/security.html">Security</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../lab-env/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenShift Virtualization cookbook</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">OpenShift Virtualization cookbook</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">OpenShift Virtualization cookbook</a></li>
    <li><a href="index.html">Virtual Machine Configuration</a></li>
    <li><a href="golden-images-troubleshooting.html">Golden Images Troubleshooting</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Golden Images Troubleshooting Guide</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide provides troubleshooting steps, verification commands, and solutions for issues related to creating and using custom OS images and golden images in OpenShift Virtualization.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_table_of_contents"><a class="anchor" href="#_table_of_contents"></a>Table of Contents</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="#_quick_health_checks">Quick Health Checks</a></p>
</li>
<li>
<p><a href="#_detailed_verification_by_step">Detailed Verification by Step</a></p>
</li>
<li>
<p><a href="#_common_issues_and_solutions">Common Issues and Solutions</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quick_health_checks"><a class="anchor" href="#_quick_health_checks"></a>Quick Health Checks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_check_namespace"><a class="anchor" href="#_check_namespace"></a>Check Namespace</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get namespace golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME             STATUS   AGE
golden-images    Active   5m</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_all_resources"><a class="anchor" href="#_check_all_resources"></a>Check All Resources</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get all -n golden-images</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_vms_and_vmis"><a class="anchor" href="#_check_vms_and_vmis"></a>Check VMs and VMIs</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get vm,vmi -n golden-images</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_datavolumes_and_pvcs"><a class="anchor" href="#_check_datavolumes_and_pvcs"></a>Check DataVolumes and PVCs</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get dv,pvc -n golden-images</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_datasources"><a class="anchor" href="#_check_datasources"></a>Check DataSources</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get datasource -n golden-images</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_detailed_verification_by_step"><a class="anchor" href="#_detailed_verification_by_step"></a>Detailed Verification by Step</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_step_1_verify_base_vm_creation"><a class="anchor" href="#_step_1_verify_base_vm_creation"></a>Step 1: Verify Base VM Creation</h3>
<div class="sect3">
<h4 id="_check_vm_status"><a class="anchor" href="#_check_vm_status"></a>Check VM Status</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get vm base-fedora-vm -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME             AGE   STATUS    READY
base-fedora-vm   2m    Running   True</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_check_vmi_details"><a class="anchor" href="#_check_vmi_details"></a>Check VMI Details</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get vmi base-fedora-vm -n golden-images -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Look for:
- <code>status.phase: Running</code>
- <code>status.interfaces[].ipAddress</code> (VM has an IP)
- <code>status.guestOSInfo.id: fedora</code> (Guest agent is running)</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">status:
  guestOSInfo:
    id: fedora
    kernelRelease: 6.11.4-301.fc41.x86_64
    kernelVersion: '#1 SMP PREEMPT_DYNAMIC Thu Oct 10 16:16:06 UTC 2024'
    name: Fedora Linux
    prettyName: Fedora Linux 41 (Cloud Edition)
    version: '41'
    versionId: '41'
  interfaces:
  - infoSource: domain, guest-agent, multus-status
    interfaceName: eth0
    ipAddress: 10.128.0.168
    ipAddresses:
    - 10.128.0.168
    - fd02::76
    mac: 02:92:c2:00:00:06
    name: default
    queueCount: 1
  phase: Running</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_check_base_vm_datavolume"><a class="anchor" href="#_check_base_vm_datavolume"></a>Check Base VM DataVolume</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get dv base-fedora-vm-disk -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME                  PHASE       PROGRESS   RESTARTS   AGE
base-fedora-vm-disk   Succeeded   100.0%                5m</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_check_pvc_for_base_vm"><a class="anchor" href="#_check_pvc_for_base_vm"></a>Check PVC for Base VM</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pvc base-fedora-vm-disk -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output shows <code>Bound</code> status and correct storage class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME                  STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
base-fedora-vm-disk   Bound    pvc-abc123...                              30Gi       RWO            lvms-vg1       5m</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_verify_vm_customization"><a class="anchor" href="#_step_2_verify_vm_customization"></a>Step 2: Verify VM Customization</h3>
<div class="sect3">
<h4 id="_access_vm_console"><a class="anchor" href="#_access_vm_console"></a>Access VM Console</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">virtctl console base-fedora-vm -n golden-images</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_check_if_software_is_installed"><a class="anchor" href="#_check_if_software_is_installed"></a>Check if Software is Installed</h4>
<div class="paragraph">
<p>Inside the VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># For nginx
systemctl status nginx
nginx -v

# For custom configuration
cat /etc/nginx/nginx.conf
ls -la /usr/share/nginx/html/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_check_cloud_init_logs_if_used"><a class="anchor" href="#_check_cloud_init_logs_if_used"></a>Check Cloud-init Logs (if used)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat /var/log/cloud-init.log
cat /var/log/cloud-init-output.log</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_verify_vm_shutdown"><a class="anchor" href="#_step_3_verify_vm_shutdown"></a>Step 3: Verify VM Shutdown</h3>
<div class="sect3">
<h4 id="_check_vm_is_stopped"><a class="anchor" href="#_check_vm_is_stopped"></a>Check VM is Stopped</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get vm base-fedora-vm -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME             AGE   STATUS    READY
base-fedora-vm   10m   Stopped   False</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_verify_no_vmi_exists"><a class="anchor" href="#_verify_no_vmi_exists"></a>Verify No VMI Exists</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get vmi base-fedora-vm -n golden-images 2&gt;&amp;1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Error from server (NotFound): virtualmachineinstances.kubevirt.io "base-fedora-vm" not found</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_verify_datasource_creation"><a class="anchor" href="#_step_4_verify_datasource_creation"></a>Step 4: Verify DataSource Creation</h3>
<div class="sect3">
<h4 id="_check_datasource"><a class="anchor" href="#_check_datasource"></a>Check DataSource</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get datasource fedora-nginx-golden -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME                   AGE
fedora-nginx-golden    1m</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_check_datasource_details"><a class="anchor" href="#_check_datasource_details"></a>Check DataSource Details</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get datasource fedora-nginx-golden -n golden-images -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Look for:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  source:
    pvc:
      name: base-fedora-vm-disk
      namespace: golden-images</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_5_verify_vms_deployed_from_golden_image"><a class="anchor" href="#_step_5_verify_vms_deployed_from_golden_image"></a>Step 5: Verify VMs Deployed from Golden Image</h3>
<div class="sect3">
<h4 id="_check_deployed_vms"><a class="anchor" href="#_check_deployed_vms"></a>Check Deployed VMs</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get vm webserver-vm-1 webserver-vm-2 -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME              AGE   STATUS    READY
webserver-vm-1    2m    Running   True
webserver-vm-2    2m    Running   True</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_check_datavolumes_for_deployed_vms"><a class="anchor" href="#_check_datavolumes_for_deployed_vms"></a>Check DataVolumes for Deployed VMs</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get dv webserver-vm-1-disk webserver-vm-2-disk -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME                   PHASE       PROGRESS   RESTARTS   AGE
webserver-vm-1-disk    Succeeded   100.0%                2m
webserver-vm-2-disk    Succeeded   100.0%                2m</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_verify_vms_are_clones"><a class="anchor" href="#_verify_vms_are_clones"></a>Verify VMs are Clones</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get dv webserver-vm-1-disk -n golden-images -o jsonpath='{.spec.sourceRef}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output shows reference to DataSource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"kind":"DataSource","name":"fedora-nginx-golden","namespace":"golden-images"}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_check_vm_functionality"><a class="anchor" href="#_check_vm_functionality"></a>Check VM Functionality</h4>
<div class="paragraph">
<p>Get VM IPs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get vmi webserver-vm-1 webserver-vm-2 -n golden-images -o jsonpath='{range .items[*]}{.metadata.name}: {.status.interfaces[0].ipAddress}{"\n"}{end}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">webserver-vm-1: 10.128.0.169
webserver-vm-2: 10.128.0.170</code></pre>
</div>
</div>
<div class="paragraph">
<p>Test nginx from another pod:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc run test-curl --image=curlimages/curl:latest --rm -it --restart=Never -- curl http://10.128.0.169</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_6_verify_resource_efficiency"><a class="anchor" href="#_step_6_verify_resource_efficiency"></a>Step 6: Verify Resource Efficiency</h3>
<div class="sect3">
<h4 id="_check_pvc_usage"><a class="anchor" href="#_check_pvc_usage"></a>Check PVC Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pvc -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Look for multiple PVCs all sourced from the base VM disk, showing efficient cloning:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME                   STATUS   VOLUME           CAPACITY   ACCESS MODES   STORAGECLASS   AGE
base-fedora-vm-disk    Bound    pvc-abc123...    30Gi       RWO            lvms-vg1       15m
webserver-vm-1-disk    Bound    pvc-def456...    30Gi       RWO            lvms-vg1       5m
webserver-vm-2-disk    Bound    pvc-ghi789...    30Gi       RWO            lvms-vg1       5m</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_check_actual_storage_usage_if_using_lvm"><a class="anchor" href="#_check_actual_storage_usage_if_using_lvm"></a>Check Actual Storage Usage (if using LVM)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Get the LVM thin pool usage
oc get lvmvolumegroup -n openshift-storage -o yaml | grep -A 10 status</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common_issues_and_solutions"><a class="anchor" href="#_common_issues_and_solutions"></a>Common Issues and Solutions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_issue_1_base_vm_datavolume_stuck_in_importinprogress"><a class="anchor" href="#_issue_1_base_vm_datavolume_stuck_in_importinprogress"></a>Issue 1: Base VM DataVolume Stuck in ImportInProgress</h3>
<div class="paragraph">
<p><strong>Symptoms</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get dv base-fedora-vm-disk -n golden-images
NAME                  PHASE              PROGRESS   AGE
base-fedora-vm-disk   ImportInProgress   10%        10m</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Diagnosis</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Check CDI importer pod
oc get pods -n golden-images | grep importer

# Check importer logs
oc logs -n golden-images &lt;importer-pod-name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Common Causes</strong>:
- Source DataSource not available
- Network issues downloading image
- Insufficient storage space
- Storage class issues</p>
</div>
<div class="paragraph">
<p><strong>Solutions</strong>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify source DataSource exists:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get datasource fedora -n openshift-virtualization-os-images</code></pre>
</div>
</div>
</li>
<li>
<p>Check CDI operator is healthy:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods -n openshift-cnv | grep cdi</code></pre>
</div>
</div>
</li>
<li>
<p>Check storage capacity:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pvc -n golden-images
oc get lvmvolumegroup -n openshift-storage</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_issue_2_vm_will_not_start_waiting_for_datavolume"><a class="anchor" href="#_issue_2_vm_will_not_start_waiting_for_datavolume"></a>Issue 2: VM Will Not Start - Waiting for DataVolume</h3>
<div class="paragraph">
<p><strong>Symptoms</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get vm base-fedora-vm -n golden-images
NAME             AGE   STATUS                                    READY
base-fedora-vm   5m    WaitingForVolumeBinding                   False</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Diagnosis</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Check DataVolume status
oc get dv base-fedora-vm-disk -n golden-images

# Check events
oc get events -n golden-images --sort-by='.lastTimestamp' | grep -i error</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Common Causes</strong>:
- DataVolume in <code>PendingPopulation</code> or failed state
- Storage class issues
- PVC binding issues</p>
</div>
<div class="paragraph">
<p><strong>Solutions</strong>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If using <code>WaitForFirstConsumer</code>, this is normal - VM will start once DV is ready</p>
</li>
<li>
<p>Check storage class exists and is properly configured:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get storageclass</code></pre>
</div>
</div>
</li>
<li>
<p>Verify default storage class if not specified:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get storageclass -o jsonpath='{.items[?(@.metadata.annotations.storageclass\.kubernetes\.io/is-default-class=="true")].metadata.name}'</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_issue_3_guest_agent_not_running"><a class="anchor" href="#_issue_3_guest_agent_not_running"></a>Issue 3: Guest Agent Not Running</h3>
<div class="paragraph">
<p><strong>Symptoms</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get vmi base-fedora-vm -n golden-images -o jsonpath='{.status.guestOSInfo}'
# Returns empty</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Diagnosis</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Access VM console
virtctl console base-fedora-vm -n golden-images

# Check if qemu-guest-agent is installed
rpm -qa | grep qemu-guest-agent

# Check service status
systemctl status qemu-guest-agent</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Solutions</strong>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install guest agent:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo dnf install -y qemu-guest-agent
sudo systemctl enable --now qemu-guest-agent</code></pre>
</div>
</div>
</li>
<li>
<p>For cloud images, guest agent should be pre-installed. If not, the image may be corrupted.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_issue_4_deployed_vms_do_not_have_custom_software"><a class="anchor" href="#_issue_4_deployed_vms_do_not_have_custom_software"></a>Issue 4: Deployed VMs Do Not Have Custom Software</h3>
<div class="paragraph">
<p><strong>Symptoms</strong>:
VM deployed from golden image does not have nginx or custom configuration.</p>
</div>
<div class="paragraph">
<p><strong>Diagnosis</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Access the VM
virtctl console webserver-vm-1 -n golden-images

# Check for nginx
which nginx
systemctl status nginx</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Common Causes</strong>:
- Base VM was not customized before creating DataSource
- DataSource references wrong PVC
- VM cloning failed</p>
</div>
<div class="paragraph">
<p><strong>Solutions</strong>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify base VM has customizations:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">virtctl console base-fedora-vm -n golden-images
# Check manually for installed software</code></pre>
</div>
</div>
</li>
<li>
<p>Verify DataSource references correct PVC:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get datasource fedora-nginx-golden -n golden-images -o jsonpath='{.spec.source}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Should reference PVC <code>base-fedora-vm-disk</code>.</p>
</div>
</li>
<li>
<p>Recreate DataSource with correct PVC reference if needed.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_issue_5_datasource_references_wrong_pvc"><a class="anchor" href="#_issue_5_datasource_references_wrong_pvc"></a>Issue 5: DataSource References Wrong PVC</h3>
<div class="paragraph">
<p><strong>Symptoms</strong>:
VMs deployed from DataSource do not have expected customizations from base VM.</p>
</div>
<div class="paragraph">
<p><strong>Diagnosis</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get datasource fedora-nginx-golden -n golden-images -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Look at <code>spec.source.pvc.name</code> - should reference <code>base-fedora-vm-disk</code>.</p>
</div>
<div class="paragraph">
<p><strong>Solutions</strong>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete and recreate DataSource with correct PVC reference:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete datasource fedora-nginx-golden -n golden-images
oc create -f fedora-golden-datasource.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_issue_6_insufficient_storage_space"><a class="anchor" href="#_issue_6_insufficient_storage_space"></a>Issue 6: Insufficient Storage Space</h3>
<div class="paragraph">
<p><strong>Symptoms</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Failed to create PVC: insufficient storage</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Diagnosis</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Check LVM volume group usage
oc get lvmvolumegroup -n openshift-storage -o yaml

# Check PVC requests vs available
oc get pvc -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Solutions</strong>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clean up unused PVCs:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete pvc &lt;unused-pvc&gt; -n golden-images</code></pre>
</div>
</div>
</li>
<li>
<p>Expand LVM volume group (if using additional disks)</p>
</li>
<li>
<p>Reduce requested storage size in VM/DataVolume specs</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_issue_7_vm_cloning_is_slow"><a class="anchor" href="#_issue_7_vm_cloning_is_slow"></a>Issue 7: VM Cloning is Slow</h3>
<div class="paragraph">
<p><strong>Symptoms</strong>:
DataVolume for deployed VM takes a long time to reach <code>Succeeded</code> phase.</p>
</div>
<div class="paragraph">
<p><strong>Diagnosis</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Check DataVolume progress
oc get dv webserver-vm-1-disk -n golden-images -w

# Check CDI pod logs
oc logs -n golden-images -l app=containerized-data-importer --tail=100</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Common Causes</strong>:
- Large disk size
- Storage backend performance
- Not using efficient cloning (e.g., not using DataSource)</p>
</div>
<div class="paragraph">
<p><strong>Solutions</strong>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure using DataSource for efficient cloning:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  sourceRef:
    kind: DataSource
    name: fedora-nginx-golden</code></pre>
</div>
</div>
</li>
<li>
<p>Use storage class that supports fast cloning (e.g., smart clones with LVM thin provisioning)</p>
</li>
<li>
<p>Consider reducing disk size if VMs do not need large volumes</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_diagnostic_commands_summary"><a class="anchor" href="#_diagnostic_commands_summary"></a>Diagnostic Commands Summary</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_full_resource_check"><a class="anchor" href="#_full_resource_check"></a>Full Resource Check</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Everything in namespace
oc get all,dv,pvc,datasource -n golden-images

# With more details
oc get all,dv,pvc,datasource -n golden-images -o wide

# Watch for changes
oc get vm,vmi,dv -n golden-images -w</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_logs_and_events"><a class="anchor" href="#_logs_and_events"></a>Logs and Events</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Recent events
oc get events -n golden-images --sort-by='.lastTimestamp' | tail -20

# VM events
oc describe vm base-fedora-vm -n golden-images | tail -20

# CDI operator logs
oc logs -n openshift-cnv -l app=cdi-operator --tail=50</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_storage_details"><a class="anchor" href="#_storage_details"></a>Storage Details</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># PVC details
oc describe pvc &lt;pvc-name&gt; -n golden-images

# Storage class configuration
oc get storageclass -o yaml

# LVM status (if using LVM)
oc get lvmvolumegroup,lvmvolumegroupnodestatus -n openshift-storage</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_resources"><a class="anchor" href="#_additional_resources"></a>Additional Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/virt/about_virt/about-virt.html" target="_blank" rel="noopener">OpenShift Virtualization Documentation</a></p>
</li>
<li>
<p><a href="https://kubevirt.io/user-guide/storage/disks_and_volumes/" target="_blank" rel="noopener">KubeVirt User Guide - DataVolumes</a></p>
</li>
<li>
<p><a href="https://github.com/kubevirt/containerized-data-importer" target="_blank" rel="noopener">Containerized Data Importer (CDI)</a></p>
</li>
<li>
<p><a href="../storage/lvm-troubleshooting.html" class="xref page">LVM Storage Troubleshooting</a></p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="custom-golden-images.html">Custom Golden Images</a></span>
  <span class="next"><a href="../manifests/index.html">YAML Manifests Reference</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
