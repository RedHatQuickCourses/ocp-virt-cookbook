<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Creating Custom OS Images and Golden Images :: OpenShift Virtualization cookbook</title>
    <link rel="prev" href="remote-access-windows-vms.html">
    <link rel="next" href="golden-images-troubleshooting.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">OpenShift Virtualization cookbook</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/ocp-virt-cookbook/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ocp-virt-cookbook" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OpenShift Virtualization cookbook</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting-started/index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/prerequisites.html">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/virtctl-basics.html">Virtctl Basics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/default-storage-class.html">Storage Setup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../storage/index.html">Storage Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/lvm-operator.html">LVM Operator Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/lvm-troubleshooting.html">LVM Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../networking/index.html">Networking Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/udn-primary-networks.html">UDN Primary Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/localnet-secondary.html">Localnet Secondary Networks with CUDN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/localnet-vlan.html">Localnet Secondary Networks with VLAN using NAD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/cudn-localnet-vlan.html">Localnet VLAN with CUDN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/linux-bridges.html">Linux Bridges</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/ovs-bridge-troubleshooting.html">Troubleshooting OVS Bridge Creation for Localnet Networks</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Virtual Machine Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cloud-init-ip-configuration.html">Cloud-init IP Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cloud-init-troubleshooting.html">Cloud-init Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="internal-dns-for-vms.html">Internal DNS for VMs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="remote-access-linux-vms.html">Remote Access to Linux VMs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="remote-access-linux-troubleshooting.html">Remote Access to Linux VMs Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="remote-access-windows-vms.html">Remote Access to Windows VMs via RDP</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="custom-golden-images.html">Custom Golden Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="golden-images-troubleshooting.html">Golden Images Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../manifests/index.html">YAML Manifests Reference</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/operators.html">Operators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/networking.html">Networking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/storage.html">Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/vms.html">Virtual Machines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/security.html">Security</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../lab-env/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenShift Virtualization cookbook</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">OpenShift Virtualization cookbook</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">OpenShift Virtualization cookbook</a></li>
    <li><a href="index.html">Virtual Machine Configuration</a></li>
    <li><a href="custom-golden-images.html">Custom Golden Images</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Creating Custom OS Images and Golden Images</h1>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial demonstrates how to create custom golden images for OpenShift Virtualization. Golden images are pre-configured VM disk images that serve as templates for deploying multiple VMs with consistent software, configurations, and settings. This approach accelerates deployment, ensures consistency across environments, and reduces configuration drift.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_are_golden_images"><a class="anchor" href="#_what_are_golden_images"></a>What are Golden Images?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Golden images are standardized, pre-configured VM images that contain:
- Base operating system
- Pre-installed software packages
- System configurations
- Security hardening
- Optimizations</p>
</div>
<div class="paragraph">
<p>Benefits of using golden images:
- Faster VM deployment (no need to install software after boot)
- Consistency across all VMs
- Reduced configuration errors
- Simplified maintenance and updates
- Version control for VM configurations</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OpenShift 4.18+ with OpenShift Virtualization operator installed</p>
</li>
<li>
<p>CLI tools: <code>oc</code>, <code>virtctl</code>, <code>kubectl</code></p>
</li>
<li>
<p>Storage class configured (this tutorial uses <code>lvms-vg1</code>)</p>
</li>
<li>
<p>Basic understanding of Linux system administration</p>
</li>
<li>
<p>Basic understanding of cloud-init</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_golden_image_workflow"><a class="anchor" href="#_golden_image_workflow"></a>Golden Image Workflow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The process involves these steps:
. Deploy a base VM from a standard OS image
. Customize the VM (install software, configure settings)
. Generalize the VM (remove machine-specific data)
. Stop the VM and capture its disk
. Create a DataSource for the golden image
. Deploy new VMs from the golden image</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_1_deploy_base_vm"><a class="anchor" href="#_step_1_deploy_base_vm"></a>Step 1: Deploy Base VM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a namespace for the golden image workflow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create namespace golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a base Fedora VM that we will customize:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kubevirt.io/v1
kind: VirtualMachine
metadata:
  name: base-fedora-vm
  namespace: golden-images
spec:
  dataVolumeTemplates:
    - apiVersion: cdi.kubevirt.io/v1beta1
      kind: DataVolume
      metadata:
        name: base-fedora-vm-disk
      spec:
        sourceRef:
          kind: DataSource
          name: fedora
          namespace: openshift-virtualization-os-images
        storage:
          resources:
            requests:
              storage: 30Gi
  runStrategy: RerunOnFailure
  template:
    metadata:
      labels:
        kubevirt.io/domain: base-fedora-vm
    spec:
      domain:
        cpu:
          cores: 2
        devices:
          disks:
            - disk:
                bus: virtio
              name: rootdisk
            - disk:
                bus: virtio
              name: cloudinitdisk
          interfaces:
            - masquerade: {}
              name: default
          rng: {}
        machine:
          type: pc-q35-rhel9.4.0
        memory:
          guest: 4Gi
      networks:
        - name: default
          pod: {}
      volumes:
        - dataVolume:
            name: base-fedora-vm-disk
          name: rootdisk
        - cloudInitNoCloud:
            userData: |-
              #cloud-config
              user: fedora
              password: fedora123
              chpasswd: { expire: false }
              ssh_pwauth: true
          name: cloudinitdisk</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save this as <code>base-fedora-vm.yaml</code> and deploy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f base-fedora-vm.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait for the VM to be ready. This may take several minutes as the DataVolume clones from the source image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get dv -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output showing clone progress:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME                  PHASE             PROGRESS   RESTARTS   AGE
base-fedora-vm-disk   CloneInProgress   45.2%                 2m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the DataVolume shows <code>Succeeded</code>, check the VM status:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get vmi -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME             AGE   PHASE     IP             NODENAME   READY
base-fedora-vm   4m    Running   10.128.1.151   ocplab01   True</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: Initial disk cloning typically takes 3-5 minutes depending on your storage performance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_2_customize_the_vm"><a class="anchor" href="#_step_2_customize_the_vm"></a>Step 2: Customize the VM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Access the VM console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">virtctl console base-fedora-vm -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Login with username <code>fedora</code> and password <code>fedora123</code>.</p>
</div>
<div class="paragraph">
<p>Run the customization steps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Update system packages
sudo dnf update -y

# Install nginx web server and common tools
sudo dnf install -y nginx vim htop curl wget git

# Enable nginx to start on boot
sudo systemctl enable nginx

# Create a custom welcome page
sudo bash -c 'cat &gt; /usr/share/nginx/html/index.html &lt;&lt; EOF
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Golden Image VM&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;VM from Golden Image&lt;/h1&gt;
    &lt;p&gt;This VM was deployed from a golden image with pre-installed software.&lt;/p&gt;
    &lt;p&gt;Nginx is pre-configured and ready to use.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
EOF'

# Configure firewall
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --reload</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_3_generalize_the_vm"><a class="anchor" href="#_step_3_generalize_the_vm"></a>Step 3: Generalize the VM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before capturing the image, we need to remove machine-specific data to make it reusable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Clean package cache
sudo dnf clean all

# Clean logs
sudo find /var/log -type f -exec truncate -s 0 {} \;

# Remove machine ID
sudo rm -f /etc/machine-id
sudo touch /etc/machine-id

# Clean cloud-init
sudo cloud-init clean --logs --seed

# Clean bash history
history -c
cat /dev/null &gt; ~/.bash_history

# Sync and exit
sync
exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exit the console by pressing <code>Ctrl+]</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_4_stop_the_vm"><a class="anchor" href="#_step_4_stop_the_vm"></a>Step 4: Stop the VM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stop the VM to capture its disk:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">virtctl stop base-fedora-vm -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify it&#8217;s stopped:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get vm -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME             AGE   STATUS    READY
base-fedora-vm   15m   Stopped   False</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_5_create_golden_image_datasource"><a class="anchor" href="#_step_5_create_golden_image_datasource"></a>Step 5: Create Golden Image DataSource</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now we will create a DataSource that references the base VM&#8217;s disk. This DataSource will be used to deploy new VMs.</p>
</div>
<div class="paragraph">
<p>Create the DataSource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: cdi.kubevirt.io/v1beta1
kind: DataSource
metadata:
  name: fedora-nginx-golden
  namespace: golden-images
spec:
  source:
    pvc:
      name: base-fedora-vm-disk
      namespace: golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save as <code>fedora-golden-datasource.yaml</code> and apply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f fedora-golden-datasource.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify the DataSource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get datasource -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME                   AGE
fedora-nginx-golden    5s</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_6_deploy_vms_from_golden_image"><a class="anchor" href="#_step_6_deploy_vms_from_golden_image"></a>Step 6: Deploy VMs from Golden Image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now we can deploy multiple VMs from this golden image. Each VM will be cloned from the golden image.</p>
</div>
<div class="paragraph">
<p>Create the first VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kubevirt.io/v1
kind: VirtualMachine
metadata:
  name: webserver-vm-1
  namespace: golden-images
spec:
  dataVolumeTemplates:
    - apiVersion: cdi.kubevirt.io/v1beta1
      kind: DataVolume
      metadata:
        name: webserver-vm-1-disk
      spec:
        sourceRef:
          kind: DataSource
          name: fedora-nginx-golden
          namespace: golden-images
        storage:
          resources:
            requests:
              storage: 30Gi
  runStrategy: RerunOnFailure
  template:
    metadata:
      labels:
        kubevirt.io/domain: webserver-vm-1
    spec:
      domain:
        cpu:
          cores: 2
        devices:
          disks:
            - disk:
                bus: virtio
              name: rootdisk
            - disk:
                bus: virtio
              name: cloudinitdisk
          interfaces:
            - masquerade: {}
              name: default
          rng: {}
        machine:
          type: pc-q35-rhel9.4.0
        memory:
          guest: 4Gi
      networks:
        - name: default
          pod: {}
      volumes:
        - dataVolume:
            name: webserver-vm-1-disk
          name: rootdisk
        - cloudInitNoCloud:
            userData: |-
              #cloud-config
              hostname: webserver-vm-1
              fqdn: webserver-vm-1.example.com
          name: cloudinitdisk</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a second VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kubevirt.io/v1
kind: VirtualMachine
metadata:
  name: webserver-vm-2
  namespace: golden-images
spec:
  dataVolumeTemplates:
    - apiVersion: cdi.kubevirt.io/v1beta1
      kind: DataVolume
      metadata:
        name: webserver-vm-2-disk
      spec:
        sourceRef:
          kind: DataSource
          name: fedora-nginx-golden
          namespace: golden-images
        storage:
          resources:
            requests:
              storage: 30Gi
  runStrategy: RerunOnFailure
  template:
    metadata:
      labels:
        kubevirt.io/domain: webserver-vm-2
    spec:
      domain:
        cpu:
          cores: 2
        devices:
          disks:
            - disk:
                bus: virtio
              name: rootdisk
            - disk:
                bus: virtio
              name: cloudinitdisk
          interfaces:
            - masquerade: {}
              name: default
          rng: {}
        machine:
          type: pc-q35-rhel9.4.0
        memory:
          guest: 4Gi
      networks:
        - name: default
          pod: {}
      volumes:
        - dataVolume:
            name: webserver-vm-2-disk
          name: rootdisk
        - cloudInitNoCloud:
            userData: |-
              #cloud-config
              hostname: webserver-vm-2
              fqdn: webserver-vm-2.example.com
          name: cloudinitdisk</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deploy both VMs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f webserver-vm-1.yaml
oc apply -f webserver-vm-2.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Monitor the cloning process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get dv -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME                  PHASE             PROGRESS   RESTARTS   AGE
base-fedora-vm-disk   Succeeded         100.0%                15m
webserver-vm-1-disk   CloneInProgress   72.5%                 3m
webserver-vm-2-disk   CloneInProgress   71.8%                 3m</code></pre>
</div>
</div>
<div class="paragraph">
<p>The DataVolumes will clone from the golden image. This typically takes 3-5 minutes per VM.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_7_verify_the_vms"><a class="anchor" href="#_step_7_verify_the_vms"></a>Step 7: Verify the VMs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Check that both VMs are running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get vmi -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME             AGE   PHASE     IP             NODENAME   READY
webserver-vm-1   5m    Running   10.128.1.152   ocplab01   True
webserver-vm-2   5m    Running   10.128.1.153   ocplab01   True</code></pre>
</div>
</div>
<div class="paragraph">
<p>Access one of the VMs and verify nginx is pre-installed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">virtctl console webserver-vm-1 -n golden-images</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check nginx status:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo systemctl status nginx</code></pre>
</div>
</div>
<div class="paragraph">
<p>The service should be active (running).</p>
</div>
<div class="paragraph">
<p>Test the web server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl localhost</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see the custom HTML page created during customization.</p>
</div>
<div class="paragraph">
<p>Exit the console with <code>Ctrl+]</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_version_management"><a class="anchor" href="#_version_management"></a>Version Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To create new versions of your golden image:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy a VM from the current golden image</p>
</li>
<li>
<p>Apply updates or changes</p>
</li>
<li>
<p>Generalize the VM</p>
</li>
<li>
<p>Create a new DataSource with version in the name (e.g., <code>fedora-nginx-golden-v2</code>)</p>
</li>
<li>
<p>Update VM deployments to reference the new version</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Example DataSource naming:
- <code>fedora-nginx-golden-v1</code>
- <code>fedora-nginx-golden-v2</code>
- <code>fedora-nginx-golden-2025-10</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_best_practices"><a class="anchor" href="#_best_practices"></a>Best Practices</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_image_creation"><a class="anchor" href="#_image_creation"></a>Image Creation</h3>
<div class="ulist">
<ul>
<li>
<p>Keep customizations minimal and focused</p>
</li>
<li>
<p>Document all installed software and configurations</p>
</li>
<li>
<p>Test the golden image thoroughly before production use</p>
</li>
<li>
<p>Version your golden images</p>
</li>
<li>
<p>Maintain a changelog for each version</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_generalization"><a class="anchor" href="#_generalization"></a>Generalization</h3>
<div class="ulist">
<ul>
<li>
<p>Always clean logs and temporary files</p>
</li>
<li>
<p>Remove SSH host keys</p>
</li>
<li>
<p>Remove machine-specific identifiers</p>
</li>
<li>
<p>Clean cloud-init data</p>
</li>
<li>
<p>Clear bash history</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_storage"><a class="anchor" href="#_storage"></a>Storage</h3>
<div class="ulist">
<ul>
<li>
<p>Use appropriate disk sizes for your use case</p>
</li>
<li>
<p>Consider thin provisioning if available</p>
</li>
<li>
<p>Monitor storage usage for golden images</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_security"><a class="anchor" href="#_security"></a>Security</h3>
<div class="ulist">
<ul>
<li>
<p>Apply security updates before creating golden images</p>
</li>
<li>
<p>Remove any sensitive data or credentials</p>
</li>
<li>
<p>Disable unnecessary services</p>
</li>
<li>
<p>Configure firewall rules appropriately</p>
</li>
<li>
<p>Use cloud-init for VM-specific secrets (SSH keys, passwords)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a>Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you encounter issues during any step of this tutorial, refer to the <a href="golden-images-troubleshooting.html" class="xref page">Golden Images Troubleshooting Guide</a> for detailed verification commands, common issues, and solutions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cleanup"><a class="anchor" href="#_cleanup"></a>Cleanup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To clean up the resources created in this tutorial:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Delete VMs
oc delete vm webserver-vm-1 webserver-vm-2 base-fedora-vm -n golden-images

# Delete DataSource
oc delete datasource fedora-nginx-golden -n golden-images

# Delete namespace
oc delete namespace golden-images</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this tutorial, you learned how to:
- Deploy and customize a base VM
- Generalize a VM for reuse as a golden image
- Create a DataSource for the golden image
- Deploy multiple VMs from the golden image
- Manage golden image versions</p>
</div>
<div class="paragraph">
<p>Golden images significantly improve VM deployment efficiency and consistency in OpenShift Virtualization environments.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/virt/about_virt/about-virt.html" target="_blank" rel="noopener">OpenShift Virtualization Documentation</a></p>
</li>
<li>
<p><a href="https://kubevirt.io/user-guide/operations/clone_api/" target="_blank" rel="noopener">KubeVirt DataVolume Documentation</a></p>
</li>
<li>
<p><a href="https://github.com/kubevirt/containerized-data-importer" target="_blank" rel="noopener">Containerized Data Importer</a></p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="remote-access-windows-vms.html">Remote Access to Windows VMs via RDP</a></span>
  <span class="next"><a href="golden-images-troubleshooting.html">Golden Images Troubleshooting</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
