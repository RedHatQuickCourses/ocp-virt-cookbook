<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Internal DNS Resolution for Virtual Machines :: OpenShift Virtualization cookbook</title>
    <link rel="prev" href="cloud-init-troubleshooting.html">
    <link rel="next" href="remote-access-linux-vms.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">OpenShift Virtualization cookbook</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/ocp-virt-cookbook/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ocp-virt-cookbook" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OpenShift Virtualization cookbook</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting-started/index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/install-openshift-virtualization.html">Install OpenShift Virtualization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/prerequisites.html">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/virtctl-basics.html">Virtctl Basics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/default-storage-class.html">Storage Setup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../storage/index.html">Storage Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/lvm-operator.html">LVM Operator Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/lvm-troubleshooting.html">LVM Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../networking/index.html">Networking Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/udn-primary-networks.html">UDN Primary Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/localnet-secondary.html">Localnet Secondary Networks with CUDN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/localnet-vlan.html">Localnet Secondary Networks with VLAN using NAD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/cudn-localnet-vlan.html">Localnet VLAN with CUDN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/linux-bridges.html">Linux Bridges</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/ovs-bridge-troubleshooting.html">Troubleshooting Localnet Networks</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Virtual Machine Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cloud-init-ip-configuration.html">Cloud-init IP Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cloud-init-troubleshooting.html">Cloud-init Troubleshooting</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="internal-dns-for-vms.html">Internal DNS for VMs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="remote-access-linux-vms.html">Remote Access to Linux VMs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="remote-access-linux-troubleshooting.html">Remote Access to Linux VMs Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="remote-access-windows-vms.html">Remote Access to Windows VMs via RDP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="custom-golden-images.html">Custom Golden Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="golden-images-troubleshooting.html">Golden Images Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../manifests/index.html">YAML Manifests Reference</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/operators.html">Operators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/networking.html">Networking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/storage.html">Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/vms.html">Virtual Machines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manifests/security.html">Security</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../api/index.html">API Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/api_component_overview.html">API Component Overview</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../lab-env/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenShift Virtualization cookbook</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">OpenShift Virtualization cookbook</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">OpenShift Virtualization cookbook</a></li>
    <li><a href="index.html">Virtual Machine Configuration</a></li>
    <li><a href="internal-dns-for-vms.html">Internal DNS for VMs</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Internal DNS Resolution for Virtual Machines</h1>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial demonstrates how to make virtual machines discoverable via stable DNS names for internal cluster communication in OpenShift Virtualization. You will learn how Kubernetes Services enable DNS-based service discovery for VMs, allowing Pod-to-VM and VM-to-VM communication without hardcoded IP addresses.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_you_will_learn"><a class="anchor" href="#_what_you_will_learn"></a>What You Will Learn</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>How to expose a VM via a Kubernetes Service</p>
</li>
<li>
<p>How to test DNS resolution for VMs</p>
</li>
<li>
<p>How DNS queries are resolved for VMs in OpenShift Virtualization</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>OpenShift 4.18+ with OpenShift Virtualization operator installed</p>
</li>
<li>
<p>CLI tools installed: <code>oc</code>, <code>virtctl</code></p>
</li>
<li>
<p>Basic understanding of Kubernetes Services and DNS</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_part_1_deploy_expose_and_test"><a class="anchor" href="#_part_1_deploy_expose_and_test"></a>Part 1: Deploy, Expose, and Test</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_step_1_create_a_namespace"><a class="anchor" href="#_step_1_create_a_namespace"></a>Step 1: Create a Namespace</h3>
<div class="paragraph">
<p>Create a dedicated namespace for this tutorial:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-project myapp</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_deploy_a_fedora_vm"><a class="anchor" href="#_step_2_deploy_a_fedora_vm"></a>Step 2: Deploy a Fedora VM</h3>
<div class="paragraph">
<p>Deploy a Fedora VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f - &lt;&lt;EOF
apiVersion: kubevirt.io/v1
kind: VirtualMachine
metadata:
  name: fedora-app-vm
  namespace: myapp
  labels:
    app: myapp
spec:
  runStrategy: Always
  dataVolumeTemplates:
    - metadata:
        name: fedora-app-vm-volume
      spec:
        sourceRef:
          kind: DataSource
          name: fedora
          namespace: openshift-virtualization-os-images
        storage:
          resources:
            requests:
              storage: 30Gi
  template:
    metadata:
      labels:
        kubevirt.io/domain: fedora-app-vm
        app: myapp
    spec:
      domain:
        devices:
          disks:
            - disk:
                bus: virtio
              name: rootdisk
            - disk:
                bus: virtio
              name: cloudinitdisk
          interfaces:
            - name: default
              masquerade: {}
        resources:
          requests:
            memory: 2Gi
      networks:
        - name: default
          pod: {}
      volumes:
        - dataVolume:
            name: fedora-app-vm-volume
          name: rootdisk
        - cloudInitNoCloud:
            userData: |-
              #cloud-config
              user: fedora
              password: fedora
              chpasswd: { expire: false }
              ssh_pwauth: true
          name: cloudinitdisk
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait for the VM to be running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">watch 'oc get vm,vmi,dv -n myapp'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait until the VM shows <code>Running</code> and <code>Ready: True</code>, then press <code>Ctrl+C</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_create_a_service_for_the_vm"><a class="anchor" href="#_step_3_create_a_service_for_the_vm"></a>Step 3: Create a Service for the VM</h3>
<div class="paragraph">
<p>Create a headless Service that targets the VM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f - &lt;&lt;EOF
apiVersion: v1
kind: Service
metadata:
  name: myapp-service
  namespace: myapp
spec:
  clusterIP: None
  selector:
    kubevirt.io/domain: fedora-app-vm
  ports:
    - name: ssh
      protocol: TCP
      port: 22
      targetPort: 22
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify the Service and its EndpointSlice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get svc myapp-service -n myapp
oc get endpointslice -n myapp -l kubernetes.io/service-name=myapp-service</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected output:</p>
</div>
<div class="paragraph">
<p>The Service should show <code>TYPE: ClusterIP</code> with <code>CLUSTER-IP: None</code> (headless service).</p>
</div>
<div class="paragraph">
<p>The EndpointSlice should show the VM&#8217;s pod IP address in the ENDPOINTS column.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_test_dns_resolution_and_connectivity"><a class="anchor" href="#_step_4_test_dns_resolution_and_connectivity"></a>Step 4: Test DNS Resolution and Connectivity</h3>
<div class="paragraph">
<p>Create a debug pod to test DNS resolution and connectivity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f - &lt;&lt;EOF
apiVersion: v1
kind: Pod
metadata:
  name: debug-dns
  namespace: myapp
spec:
  containers:
  - name: debug
    image: registry.access.redhat.com/ubi9/ubi
    command: ["sleep", "3600"]
    securityContext:
      allowPrivilegeEscalation: false
      runAsNonRoot: true
      runAsUser: 1000
      capabilities:
        drop:
        - ALL
      seccompProfile:
        type: RuntimeDefault
  restartPolicy: Never
EOF

# Wait for pod to be ready
oc wait --for=condition=Ready pod/debug-dns -n myapp --timeout=60s

# Test DNS resolution
oc exec -n myapp debug-dns -- getent hosts myapp-service.myapp.svc.cluster.local

# Clean up
oc delete pod debug-dns -n myapp</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DNS resolution returns the VM&#8217;s pod IP address (e.g., <code>10.128.0.169 myapp-service.myapp.svc.cluster.local</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This confirms the Service DNS name resolves correctly to the VM&#8217;s IP address.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_part_2_understanding_how_this_works"><a class="anchor" href="#_part_2_understanding_how_this_works"></a>Part 2: Understanding How This Works</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_dns_resolution_flow"><a class="anchor" href="#_dns_resolution_flow"></a>DNS Resolution Flow</h3>
<div class="paragraph">
<p>When a pod or VM queries a Service by its DNS name, the following flow occurs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">┌───────────────────────────────────────────────────────────────┐
│ OpenShift Cluster                                             │
│                                                               │
│  [Client VM/Pod]                                              │
│         │                                                     │
│         │ 1. DNS Query: myapp-service.myapp.svc...            │
│         │                                                     │
│         ↓                                                     │
│  [/etc/resolv.conf]                                           │
│   nameserver 172.30.0.10                                      │
│   search myapp.svc.cluster.local svc.cluster.local            │
│         │                                                     │
│         │ 2. Send query to DNS server                         │
│         ↓                                                     │
│  ┌──────────────┐                                             │
│  │   CoreDNS    │                                             │
│  │ 172.30.0.10  │                                             │
│  └──────┬───────┘                                             │
│         │                                                     │
│         │ 3. Lookup Service record                            │
│         ↓                                                     │
│  ┌──────────────────────────────────────────────┐             │
│  │ Service: myapp-service                       │             │
│  │ Type: Headless                               │             │
│  │ Selector: kubevirt.io/domain=fedora-app-vm   │             │
│  └──────┬───────────────────────────────────────┘             │
│         │                                                     │
│         │ 4. Return VM Pod IP                                 │
│         ↓                                                     │
│  [Client receives: 10.128.2.45]                               │
│         │                                                     │
│         │ 5. Connect to VM                                    │
│         ↓                                                     │
│  ┌──────────────────────┐                                     │
│  │  fedora-app-vm       │                                     │
│  │  IP: 10.128.2.45     │                                     │
│  └──────────────────────┘                                     │
│                                                               │
└───────────────────────────────────────────────────────────────┘</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_by_step_explanation"><a class="anchor" href="#_step_by_step_explanation"></a>Step-by-Step Explanation</h3>
<div class="paragraph">
<p><strong>Step 1: DNS Query Initiated</strong></p>
</div>
<div class="paragraph">
<p>A client (another VM or pod) needs to connect to <code>myapp-service.myapp.svc.cluster.local</code>. It initiates a DNS query.</p>
</div>
<div class="paragraph">
<p><strong>Step 2: Query Sent to CoreDNS</strong></p>
</div>
<div class="paragraph">
<p>The client reads its <code>/etc/resolv.conf</code> file, which points to the cluster DNS service (typically <code>172.30.0.10</code>). The DNS query is sent to CoreDNS.</p>
</div>
<div class="paragraph">
<p><strong>Step 3: CoreDNS Looks Up Service Record</strong></p>
</div>
<div class="paragraph">
<p>CoreDNS maintains a database of all Kubernetes Services in the cluster. It looks up the Service named <code>myapp-service</code> in the <code>myapp</code> namespace.</p>
</div>
<div class="paragraph">
<p><strong>Step 4: Service Returns VM Pod IP</strong></p>
</div>
<div class="paragraph">
<p>Because the Service is headless (<code>clusterIP: None</code>), CoreDNS returns the actual IP address of the VM&#8217;s pod from the EndpointSlice. For a regular ClusterIP Service, it would return the Service&#8217;s virtual IP instead.</p>
</div>
<div class="paragraph">
<p><strong>Step 5: Connection Established</strong></p>
</div>
<div class="paragraph">
<p>The client receives the IP address and establishes a direct connection to the VM.</p>
</div>
</div>
<div class="sect2">
<h3 id="_key_takeaways"><a class="anchor" href="#_key_takeaways"></a>Key Takeaways</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Services are required for DNS</strong>: Virtual machines are not automatically registered in CoreDNS. Only Kubernetes Services create DNS records.</p>
</li>
<li>
<p><strong>VM name is not a DNS name</strong>: The VM&#8217;s <code>metadata.name</code> is a Kubernetes resource identifier, not a DNS name. It cannot be used for network access.</p>
</li>
<li>
<p><strong>Service name becomes DNS name</strong>: The Service&#8217;s <code>metadata.name</code> is what gets registered in CoreDNS as <code>&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</code>.</p>
</li>
<li>
<p><strong>Headless services return VM IPs</strong>: A headless Service (<code>clusterIP: None</code>) returns the VM&#8217;s pod IP directly, enabling direct VM-to-VM communication.</p>
</li>
<li>
<p><strong>Regular services provide load balancing</strong>: A regular ClusterIP Service provides a stable virtual IP and can distribute traffic among multiple VMs.</p>
</li>
<li>
<p><strong>Search domains enable short names</strong>: The <code>search</code> domains in <code>/etc/resolv.conf</code> allow using short names like <code>myapp-service</code> instead of the full FQDN when accessing Services in the same namespace.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_part_3_reference"><a class="anchor" href="#_part_3_reference"></a>Part 3: Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_verification_commands"><a class="anchor" href="#_verification_commands"></a>Verification Commands</h3>
<div class="paragraph">
<p><strong>Check Service and EndpointSlice:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># View Service details
oc get svc myapp-service -n myapp

# Check EndpointSlice (should show VM pod IP)
oc get endpointslice -n myapp -l kubernetes.io/service-name=myapp-service

# Describe service for full details
oc describe svc myapp-service -n myapp</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Test DNS Resolution and Connectivity:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Create debug pod (if not already exists)
oc apply -f - &lt;&lt;EOF
apiVersion: v1
kind: Pod
metadata:
  name: debug-dns
  namespace: myapp
spec:
  containers:
  - name: debug
    image: registry.access.redhat.com/ubi9/ubi
    command: ["sleep", "3600"]
    securityContext:
      allowPrivilegeEscalation: false
      runAsNonRoot: true
      runAsUser: 1000
      capabilities:
        drop:
        - ALL
      seccompProfile:
        type: RuntimeDefault
  restartPolicy: Never
EOF

# Wait for pod to be ready
oc wait --for=condition=Ready pod/debug-dns -n myapp --timeout=60s

# Test DNS resolution
oc exec -n myapp debug-dns -- getent hosts myapp-service.myapp.svc.cluster.local

# Clean up when done
oc delete pod debug-dns -n myapp</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Check VM Labels:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Verify VM labels match Service selector
oc get vm fedora-app-vm -n myapp -o jsonpath='{.metadata.labels}'
oc get svc myapp-service -n myapp -o jsonpath='{.spec.selector}'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_common_issues"><a class="anchor" href="#_common_issues"></a>Common Issues</h3>
<div class="paragraph">
<p><strong>Issue: DNS resolution returns no results</strong></p>
</div>
<div class="paragraph">
<p><strong>Diagnosis:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get svc myapp-service -n myapp
oc get endpointslice -n myapp -l kubernetes.io/service-name=myapp-service</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Common causes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Service selector does not match VM labels</p>
</li>
<li>
<p>VM is not running (no EndpointSlice entries)</p>
</li>
<li>
<p>Wrong namespace</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Solutions:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify Service selector matches VM&#8217;s <code>kubevirt.io/domain</code> label exactly</p>
</li>
<li>
<p>Ensure VM is running: <code>oc get vmi -n myapp</code></p>
</li>
<li>
<p>Check that both Service and VM are in the same namespace</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Issue: Cross-namespace DNS fails</strong></p>
</div>
<div class="paragraph">
<p><strong>Diagnosis:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Create debug pod in different namespace
oc new-project test-namespace 2&gt;/dev/null || true

oc apply -f - &lt;&lt;EOF
apiVersion: v1
kind: Pod
metadata:
  name: debug-cross-ns
  namespace: test-namespace
spec:
  containers:
  - name: debug
    image: registry.access.redhat.com/ubi9/ubi
    command: ["sleep", "300"]
    securityContext:
      allowPrivilegeEscalation: false
      runAsNonRoot: true
      runAsUser: 1000
      capabilities:
        drop:
        - ALL
      seccompProfile:
        type: RuntimeDefault
  restartPolicy: Never
EOF

# Wait and test
oc wait --for=condition=Ready pod/debug-cross-ns -n test-namespace --timeout=60s
oc exec -n test-namespace debug-cross-ns -- \
  getent hosts myapp-service.myapp.svc.cluster.local

# Clean up
oc delete pod debug-cross-ns -n test-namespace</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Common causes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using short name instead of FQDN</p>
</li>
<li>
<p>Network policy blocking cross-namespace traffic</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Solutions:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Always use FQDN for cross-namespace: <code>&lt;service&gt;.&lt;namespace&gt;.svc.cluster.local</code></p>
</li>
<li>
<p>Check for restrictive NetworkPolicies</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_additional_resources"><a class="anchor" href="#_additional_resources"></a>Additional Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/" target="_blank" rel="noopener">Kubernetes DNS for Services and Pods</a></p>
</li>
<li>
<p><a href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html/virtualization/networking#virt-accessing-vm-internal-fqdn" target="_blank" rel="noopener">Accessing a VM by using the internal FQDN - OpenShift Virtualization</a></p>
</li>
<li>
<p><a href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html/virtualization/networking#virt-accessing-vm-secondary-network-fqdn" target="_blank" rel="noopener">Accessing a VM on a secondary network by using the cluster FQDN - OpenShift Virtualization</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also"><a class="anchor" href="#_see_also"></a>See Also</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="cloud-init-ip-configuration.html" class="xref page">Cloud-init IP Configuration</a></p>
</li>
<li>
<p><a href="remote-access-linux-vms.html" class="xref page">Remote Access to Linux VMs</a></p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="cloud-init-troubleshooting.html">Cloud-init Troubleshooting</a></span>
  <span class="next"><a href="remote-access-linux-vms.html">Remote Access to Linux VMs</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
