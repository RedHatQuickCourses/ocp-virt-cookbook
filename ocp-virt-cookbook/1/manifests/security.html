<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Security Manifests :: OpenShift Virtualization cookbook</title>
    <link rel="prev" href="vms.html">
    <link rel="next" href="../api/index.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">OpenShift Virtualization cookbook</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/ocp-virt-cookbook/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ocp-virt-cookbook" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OpenShift Virtualization cookbook</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting-started/index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/prerequisites.html">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/install-openshift-virtualization.html">Install OpenShift Virtualization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/default-storage-class.html">Storage Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/create-vm-web-console.html">Create VM from Web Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/virtctl-basics.html">Virtctl Basics</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../storage/index.html">Storage Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/lvm-operator.html">LVM Operator Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/lvm-troubleshooting.html">LVM Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../networking/index.html">Networking Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/udn-primary-networks.html">UDN Primary Networks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/localnet-secondary.html">Localnet Secondary Networks with CUDN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/localnet-vlan.html">Localnet Secondary Networks with VLAN using NAD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/cudn-localnet-vlan.html">Localnet VLAN with CUDN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/linux-bridges.html">Linux Bridges</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/ovs-bridge-troubleshooting.html">Troubleshooting Localnet Networks</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../vm-configuration/index.html">Virtual Machine Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/cloud-init-ip-configuration.html">Cloud-init IP Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/cloud-init-troubleshooting.html">Cloud-init Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/internal-dns-for-vms.html">Internal DNS for VMs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/remote-access-linux-vms.html">Remote Access to Linux VMs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/remote-access-linux-troubleshooting.html">Remote Access to Linux VMs Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/remote-access-windows-vms.html">Remote Access to Windows VMs via RDP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/custom-golden-images.html">Custom Golden Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vm-configuration/golden-images-troubleshooting.html">Golden Images Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">YAML Manifests Reference</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="operators.html">Operators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="networking.html">Networking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="storage.html">Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="vms.html">Virtual Machines</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="security.html">Security</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../api/index.html">API Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../api/api_component_overview.html">API Component Overview</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../lab-env/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenShift Virtualization cookbook</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">OpenShift Virtualization cookbook</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">OpenShift Virtualization cookbook</a></li>
    <li><a href="index.html">YAML Manifests Reference</a></li>
    <li><a href="security.html">Security</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Security Manifests</h1>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This page provides security-related YAML manifests for OpenShift Virtualization, including Network Policies, RBAC (Role-Based Access Control), and SCCs (Security Context Constraints).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_network_policies"><a class="anchor" href="#_network_policies"></a>Network Policies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Network Policies control traffic flow between pods and VMs in OpenShift.</p>
</div>
<div class="sect2">
<h3 id="_allow_all_traffic_to_vms"><a class="anchor" href="#_allow_all_traffic_to_vms"></a>Allow All Traffic to VMs</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-to-vms
  namespace: vms-prod
spec:
  podSelector:
    matchLabels:
      kubevirt.io/domain: ""
  policyTypes:
    - Ingress
  ingress:
    - {}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Purpose:</strong> Allows all inbound traffic to VMs in namespace.</p>
</div>
<div class="paragraph">
<p><strong>When to use:</strong> Development environments, testing, non-production.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is permissive. Use restrictive policies in production.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_allow_traffic_from_specific_namespace"><a class="anchor" href="#_allow_traffic_from_specific_namespace"></a>Allow Traffic from Specific Namespace</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-from-app-namespace
  namespace: vms-prod
spec:
  podSelector:
    matchLabels:
      kubevirt.io/domain: ""
  policyTypes:
    - Ingress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: app-frontend</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Purpose:</strong> Allows traffic only from pods in <code>app-frontend</code> namespace.</p>
</div>
<div class="paragraph">
<p><strong>When to use:</strong> Isolating VMs to specific application namespaces.</p>
</div>
</div>
<div class="sect2">
<h3 id="_allow_specific_ports"><a class="anchor" href="#_allow_specific_ports"></a>Allow Specific Ports</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-web-traffic
  namespace: vms-prod
spec:
  podSelector:
    matchLabels:
      app: webserver
      kubevirt.io/domain: ""
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector: {}
      ports:
        - protocol: TCP
          port: 80
        - protocol: TCP
          port: 443</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Purpose:</strong> Allows HTTP/HTTPS traffic to web server VMs.</p>
</div>
<div class="paragraph">
<p><strong>When to use:</strong> Web-facing VMs requiring restricted access.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deny_all_traffic_default_deny"><a class="anchor" href="#_deny_all_traffic_default_deny"></a>Deny All Traffic (Default Deny)</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-all
  namespace: vms-prod
spec:
  podSelector: {}
  policyTypes:
    - Ingress
    - Egress</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Purpose:</strong> Denies all traffic unless explicitly allowed by other policies.</p>
</div>
<div class="paragraph">
<p><strong>When to use:</strong> Security-first approach, explicitly allow only required traffic.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Add this first, then add specific allow policies as needed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_allow_dns_and_ssh"><a class="anchor" href="#_allow_dns_and_ssh"></a>Allow DNS and SSH</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-dns-and-ssh
  namespace: vms-prod
spec:
  podSelector:
    matchLabels:
      kubevirt.io/domain: ""
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 22
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              name: openshift-dns
      ports:
        - protocol: UDP
          port: 53
    - to:
        - podSelector: {}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Purpose:</strong> Allows SSH access and DNS resolution.</p>
</div>
<div class="paragraph">
<p><strong>Key Features:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>SSH (port 22) ingress from any namespace</p>
</li>
<li>
<p>DNS (port 53) egress to DNS namespace</p>
</li>
<li>
<p>Allows egress to pods in same namespace</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rbac_role_based_access_control"><a class="anchor" href="#_rbac_role_based_access_control"></a>RBAC (Role-Based Access Control)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RBAC controls who can perform actions on OpenShift resources.</p>
</div>
<div class="sect2">
<h3 id="_vm_viewer_role"><a class="anchor" href="#_vm_viewer_role"></a>VM Viewer Role</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: vm-viewer
  namespace: vms-prod
rules:
  - apiGroups:
      - kubevirt.io
    resources:
      - virtualmachines
      - virtualmachineinstances
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - ""
    resources:
      - pods
      - services
    verbs:
      - get
      - list</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Purpose:</strong> Read-only access to VMs in namespace.</p>
</div>
<div class="paragraph">
<p><strong>Permissions:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>View VMs and VMIs</p>
</li>
<li>
<p>View related pods and services</p>
</li>
<li>
<p>No modify permissions</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_operator_role"><a class="anchor" href="#_vm_operator_role"></a>VM Operator Role</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: vm-operator
  namespace: vms-prod
rules:
  - apiGroups:
      - kubevirt.io
    resources:
      - virtualmachines
      - virtualmachineinstances
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - update
      - patch
  - apiGroups:
      - subresources.kubevirt.io
    resources:
      - virtualmachines/start
      - virtualmachines/stop
      - virtualmachines/restart
    verbs:
      - update
  - apiGroups:
      - ""
    resources:
      - persistentvolumeclaims
    verbs:
      - get
      - list
      - create
  - apiGroups:
      - cdi.kubevirt.io
    resources:
      - datavolumes
    verbs:
      - get
      - list
      - create</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Purpose:</strong> Full VM lifecycle management within namespace.</p>
</div>
<div class="paragraph">
<p><strong>Permissions:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create, modify, delete VMs</p>
</li>
<li>
<p>Start, stop, restart VMs</p>
</li>
<li>
<p>Create PVCs and DataVolumes</p>
</li>
<li>
<p>View resources</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_vm_admin_role"><a class="anchor" href="#_vm_admin_role"></a>VM Admin Role</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: vm-admin
  namespace: vms-prod
rules:
  - apiGroups:
      - ""
      - kubevirt.io
      - cdi.kubevirt.io
      - k8s.cni.cncf.io
    resources:
      - "*"
    verbs:
      - "*"</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Purpose:</strong> Full administrative access to all VM-related resources in namespace.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Very permissive. Use sparingly and only for administrators.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_role_binding"><a class="anchor" href="#_role_binding"></a>Role Binding</h3>
<div class="paragraph">
<p>Bind roles to users or groups:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: vm-operators-binding
  namespace: vms-prod
subjects:
  - kind: User
    name: alice@example.com
    apiGroup: rbac.authorization.k8s.io
  - kind: Group
    name: vm-operators
    apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: vm-operator
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Purpose:</strong> Grants <code>vm-operator</code> role to user Alice and group vm-operators.</p>
</div>
</div>
<div class="sect2">
<h3 id="_clusterrole_for_vm_management_across_namespaces"><a class="anchor" href="#_clusterrole_for_vm_management_across_namespaces"></a>ClusterRole for VM Management Across Namespaces</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cluster-vm-operator
rules:
  - apiGroups:
      - kubevirt.io
    resources:
      - virtualmachines
      - virtualmachineinstances
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - update
      - patch
  - apiGroups:
      - subresources.kubevirt.io
    resources:
      - virtualmachines/start
      - virtualmachines/stop
      - virtualmachines/restart
    verbs:
      - update</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Purpose:</strong> VM management permissions across all namespaces.</p>
</div>
<div class="paragraph">
<p><strong>Binding:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cluster-vm-operators-binding
subjects:
  - kind: Group
    name: platform-team
    apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: cluster-vm-operator
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security_context_constraints_sccs"><a class="anchor" href="#_security_context_constraints_sccs"></a>Security Context Constraints (SCCs)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SCCs control pod security policies in OpenShift.</p>
</div>
<div class="sect2">
<h3 id="_vm_privileged_scc"><a class="anchor" href="#_vm_privileged_scc"></a>VM Privileged SCC</h3>
<div class="paragraph">
<p>OpenShift Virtualization VMs require specific SCCs. The operator automatically creates required SCCs.</p>
</div>
<div class="paragraph">
<p>Check VM-related SCCs:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># List SCCs
oc get scc | grep kubevirt

# View specific SCC
oc describe scc kubevirt-controller</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Pre-configured SCCs:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>kubevirt-controller</code> - For virt-controller</p>
</li>
<li>
<p><code>kubevirt-handler</code> - For virt-handler</p>
</li>
<li>
<p><code>hostmount-anyuid</code> - For VM launcher pods</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Generally, you don&#8217;t need to create custom SCCs for VMs. The operator handles this.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_custom_scc_for_specific_vm_workloads"><a class="anchor" href="#_custom_scc_for_specific_vm_workloads"></a>Custom SCC for Specific VM Workloads</h3>
<div class="paragraph">
<p>If needed, create custom SCC:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: security.openshift.io/v1
kind: SecurityContextConstraints
metadata:
  name: vm-custom-scc
allowPrivilegedContainer: false
allowHostDirVolumePlugin: false
allowHostIPC: false
allowHostNetwork: false
allowHostPID: false
allowHostPorts: false
readOnlyRootFilesystem: false
runAsUser:
  type: RunAsAny
seLinuxContext:
  type: MustRunAs
fsGroup:
  type: RunAsAny
supplementalGroups:
  type: RunAsAny
volumes:
  - configMap
  - downwardAPI
  - emptyDir
  - persistentVolumeClaim
  - projected
  - secret</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>When to use:</strong> Custom security requirements beyond default VM SCCs.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_accounts"><a class="anchor" href="#_service_accounts"></a>Service Accounts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Service accounts for VM management automation.</p>
</div>
<div class="sect2">
<h3 id="_vm_management_service_account"><a class="anchor" href="#_vm_management_service_account"></a>VM Management Service Account</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: ServiceAccount
metadata:
  name: vm-manager
  namespace: vms-prod
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: vm-manager-binding
  namespace: vms-prod
subjects:
  - kind: ServiceAccount
    name: vm-manager
    namespace: vms-prod
roleRef:
  kind: Role
  name: vm-operator
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Purpose:</strong> Service account for automated VM management.</p>
</div>
<div class="paragraph">
<p><strong>Use cases:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>CI/CD pipelines</p>
</li>
<li>
<p>Automation scripts</p>
</li>
<li>
<p>Monitoring tools</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security_best_practices"><a class="anchor" href="#_security_best_practices"></a>Security Best Practices</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Principle of Least Privilege</strong></p>
<div class="paragraph">
<p>Grant minimum necessary permissions.</p>
</div>
</li>
<li>
<p><strong>Network Segmentation</strong></p>
<div class="paragraph">
<p>Use Network Policies to isolate VM workloads.</p>
</div>
</li>
<li>
<p><strong>Regular Audits</strong></p>
<div class="paragraph">
<p>Review RBAC assignments periodically.</p>
</div>
</li>
<li>
<p><strong>Service Account Management</strong></p>
<div class="paragraph">
<p>Use service accounts for automation, not user credentials.</p>
</div>
</li>
<li>
<p><strong>Default Deny</strong></p>
<div class="paragraph">
<p>Start with deny-all Network Policy, then allow specific traffic.</p>
</div>
</li>
<li>
<p><strong>Namespace Isolation</strong></p>
<div class="paragraph">
<p>Use separate namespaces for different environments.</p>
</div>
</li>
<li>
<p><strong>Secrets Management</strong></p>
<div class="paragraph">
<p>Don&#8217;t hardcode passwords in cloud-init userData.</p>
</div>
</li>
<li>
<p><strong>SSH Key Authentication</strong></p>
<div class="paragraph">
<p>Use SSH keys instead of passwords for VM access.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verification"><a class="anchor" href="#_verification"></a>Verification</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_check_network_policies"><a class="anchor" href="#_check_network_policies"></a>Check Network Policies</h3>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># List Network Policies
oc get networkpolicy -n vms-prod

# Describe specific policy
oc describe networkpolicy &lt;policy-name&gt; -n vms-prod

# Check if policy applies to specific pod
oc get pod &lt;virt-launcher-pod&gt; -n vms-prod --show-labels</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_rbac_permissions"><a class="anchor" href="#_check_rbac_permissions"></a>Check RBAC Permissions</h3>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Check what user can do
oc auth can-i create vm -n vms-prod --as=alice@example.com

# Check all permissions for user
oc auth can-i --list -n vms-prod --as=alice@example.com

# View role bindings
oc get rolebinding -n vms-prod
oc describe rolebinding &lt;binding-name&gt; -n vms-prod</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_service_accounts"><a class="anchor" href="#_check_service_accounts"></a>Check Service Accounts</h3>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># List service accounts
oc get serviceaccount -n vms-prod

# Get service account token
oc sa get-token vm-manager -n vms-prod

# Check service account permissions
oc auth can-i --list --as=system:serviceaccount:vms-prod:vm-manager -n vms-prod</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_sccs"><a class="anchor" href="#_check_sccs"></a>Check SCCs</h3>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># List SCCs
oc get scc

# Check which SCC is used by pod
oc get pod &lt;virt-launcher-pod&gt; -n vms-prod -o yaml | grep "openshift.io/scc"

# Describe SCC
oc describe scc kubevirt-controller</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a>Troubleshooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_permission_denied_errors"><a class="anchor" href="#_permission_denied_errors"></a>Permission Denied Errors</h3>
<div class="paragraph">
<p><strong>Error:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Error from server (Forbidden): User "alice@example.com" cannot create resource "virtualmachines"</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Solution:</strong></p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Check user permissions
oc auth can-i create vm -n vms-prod --as=alice@example.com

# Check role bindings
oc get rolebinding -n vms-prod

# Add role binding if missing
oc create rolebinding alice-vm-operator \
  --role=vm-operator \
  --user=alice@example.com \
  -n vms-prod</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_network_policy_blocking_traffic"><a class="anchor" href="#_network_policy_blocking_traffic"></a>Network Policy Blocking Traffic</h3>
<div class="paragraph">
<p><strong>Symptoms:</strong> VM cannot communicate despite correct network configuration.</p>
</div>
<div class="paragraph">
<p><strong>Check:</strong></p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># List network policies
oc get networkpolicy -n vms-prod

# Check if policy matches VM pod
oc get vmi &lt;vm-name&gt; -n vms-prod -o yaml | grep labels -A 5

# Temporarily remove policy to test
oc delete networkpolicy &lt;policy-name&gt; -n vms-prod</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scc_issues"><a class="anchor" href="#_scc_issues"></a>SCC Issues</h3>
<div class="paragraph">
<p><strong>Error:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">unable to validate against any security context constraint</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Solution:</strong></p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Check available SCCs
oc get scc | grep kubevirt

# Verify operator installation
oc get csv -n openshift-cnv

# Check virt-controller logs
oc logs -n openshift-cnv deployment/virt-controller</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Key security manifest types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Network Policies</strong>: Control traffic flow between VMs and pods</p>
</li>
<li>
<p><strong>Roles/RoleBindings</strong>: Control who can manage VMs</p>
</li>
<li>
<p><strong>ClusterRoles</strong>: Cluster-wide permissions</p>
</li>
<li>
<p><strong>Service Accounts</strong>: For automation and integration</p>
</li>
<li>
<p><strong>SCCs</strong>: Pod security policies (mostly automatic)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Security approach:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start with least privilege</p>
</li>
<li>
<p>Use Network Policies for isolation</p>
</li>
<li>
<p>Grant RBAC permissions as needed</p>
</li>
<li>
<p>Use service accounts for automation</p>
</li>
<li>
<p>Regular security audits</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also"><a class="anchor" href="#_see_also"></a>See Also</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="index.html" class="xref page">Manifests Reference Overview</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/authentication/using-rbac.html" target="_blank" rel="noopener">OpenShift RBAC</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/authentication/managing-security-context-constraints.html" target="_blank" rel="noopener">Security Context Constraints</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/network_policy/about-network-policy.html" target="_blank" rel="noopener">Network Policies</a></p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="vms.html">Virtual Machines</a></span>
  <span class="next"><a href="../api/index.html">API Guide</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
